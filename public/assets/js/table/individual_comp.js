$(function(){$("#kt_daterangepicker_1").daterangepicker();let i,t,e,n;function l(a){$.ajax({url:"/getIpc/I/"+a,method:"GET",beforeSend:function(){["#ipc-flag-select-awal","#ipc-flag-select-tengah","#ipc-flag-select-akhir"].forEach(function(a){const t=$(a);t.empty(),t.append("<option>loading..</option>")})},success:function(e){["#ipc-flag-select-awal","#ipc-flag-select-tengah","#ipc-flag-select-akhir"].forEach(function(a){const t=$(a);0===e.flags.length?(t.empty(),t.append("<option>no data match...</option>")):(t.empty(),t.append('<option value="">Select IPC</option>'),e.flags.forEach(function(a){a&&t.append($("<option>",{value:a,text:a}))}))})},error:function(a){console.error("Error fetching IPC flags:",a)}})}function r(){$("#weigher-table-individu-awal").hide(),$("#weigher-table-individu-tengah").hide(),$("#weigher-table-individu-akhir").hide(),$("#summary-table-awal").hide(),$("#summary-table-tengah").hide(),$("#summary-table-akhir").hide(),$(".n-awal").text(0),$(".x-awal").text(0),$(".s_dev-awal").text(0),$(".s_rel-awal").text(0),$(".min-awal").text(0),$(".max-awal").text(0),$(".diff-awal").text(0),$(".sum-awal").text(0),$(".n-tengah").text(0),$(".x-tengah").text(0),$(".s_dev-tengah").text(0),$(".s_rel-tengah").text(0),$(".min-tengah").text(0),$(".max-tengah").text(0),$(".diff-tengah").text(0),$(".sum-tengah").text(0),$(".n-akhir").text(0),$(".x-akhir").text(0),$(".s_dev-akhir").text(0),$(".s_rel-akhir").text(0),$(".min-akhir").text(0),$(".max-akhir").text(0),$(".diff-akhir").text(0),$(".sum-akhir").text(0)}$("#weigher-table-individu-awal").hide(),$("#weigher-table-individu-tengah").hide(),$("#weigher-table-individu-akhir").hide(),$("#summary-table-awal").hide(),$("#summary-table-tengah").hide(),$("#summary-table-akhir").hide(),$("#kt_daterangepicker_1").on("change",function(){var a;a=$("#kt_daterangepicker_1").val(),$.ajax({url:"/getBn/I",method:"get",data:{date:a,_token:CSRF_TOKEN},beforeSend:function(){$("#bn-filter").empty(),$("#bn-filter").append("<option>loading...</option>")},success:function(a){0===a.length?($("#bn-filter").empty(),$("#bn-filter").append("<option>No Data Match...</option>")):setTimeout(function(){$("#bn-filter").empty(),$("#bn-filter").append("<option>Select Batch Number</option>"),$.each(a,function(a,t){$("#bn-filter").append($("<option>",{value:t.lot,text:t.lot}))})},2e3)},error:function(a,t,e){console.error("AJAX Error:",t,e),alert("Terjadi kesalahan saat memuat data. Silakan coba lagi.")}}),l(null),r()}),$("#bn-filter").on("change",function(){i=$(this).val(),""!=i&&null!=i||(i=All),l(i),r()}),$("#ipc-flag-select-awal").on("change",function(){t=$(this).val(),i=$("#bn-filter").val(),t?(s.ajax.reload(),$("#weigher-table-individu-awal").show(),$("#summary-table-awal").show(),$.ajax({url:"/getSummary/I/"+i+"/"+t,method:"GET",success:function(e){if(0<e.length)$(".n-awal").text(e[0].n),$(".x-awal").text(e[0].x),$(".s_dev-awal").text(e[0].s_dev),$(".s_rel-awal").text(e[0].s_rel),$(".min-awal").text(e[0].min),$(".max-awal").text(e[0].max),$(".diff-awal").text(e[0].diff),$(".sum-awal").text(e[0].sum);else{let t=s.rows().data().toArray();if(0<t.length){let a=t.map(a=>a.weight);var i=a.length,n=a.reduce((a,t)=>a+t),l=n/i,r=Math.min(...a),h=Math.max(...a),e=h-r;$(".n-awal").text(i),$(".x-awal").text(l),$(".s_dev-awal").text(0),$(".s_rel-awal").text(0),$(".min-awal").text(r),$(".max-awal").text(h),$(".diff-awal").text(e),$(".sum-awal").text(n)}}}})):$("#weigher-table-individu-awal").hide()}),$("#ipc-flag-select-tengah").on("change",function(){e=$(this).val(),i=$("#bn-filter").val(),e?(o.ajax.reload(),$("#weigher-table-individu-tengah").show(),$("#summary-table-tengah").show(),$.ajax({url:"/getSummary/I/"+i+"/"+e,method:"GET",success:function(e){if(0<e.length)$(".n-tengah").text(e[0].n),$(".x-tengah").text(e[0].x),$(".s_dev-tengah").text(e[0].s_dev),$(".s_rel-tengah").text(e[0].s_rel),$(".min-tengah").text(e[0].min),$(".max-tengah").text(e[0].max),$(".diff-tengah").text(e[0].diff),$(".sum-tengah").text(e[0].sum);else{let t=o.rows().data().toArray();if(0<t.length){let a=t.map(a=>a.weight);var i=a.length,n=a.reduce((a,t)=>a+t),l=n/i,r=Math.min(...a),h=Math.max(...a),e=h-r;$(".n-tengah").text(i),$(".x-tengah").text(l),$(".s_dev-tengah").text(0),$(".s_rel-tengah").text(0),$(".min-tengah").text(r),$(".max-tengah").text(h),$(".diff-tengah").text(e),$(".sum-tengah").text(n)}}}})):$("#weigher-table-individu-tengah").hide()}),$("#ipc-flag-select-akhir").on("change",function(){n=$(this).val(),i=$("#bn-filter").val(),n?(d.ajax.reload(),$("#weigher-table-individu-akhir").show(),$("#summary-table-akhir").show(),$.ajax({url:"/getSummary/I/"+i+"/"+n,method:"GET",success:function(e){if(0<e.length)$(".n-akhir").text(e[0].n),$(".x-akhir").text(e[0].x),$(".s_dev-akhir").text(e[0].s_dev),$(".s_rel-akhir").text(e[0].s_rel),$(".min-akhir").text(e[0].min),$(".max-akhir").text(e[0].max),$(".diff-akhir").text(e[0].diff),$(".sum-akhir").text(e[0].sum);else{let t=d.rows().data().toArray();if(0<t.length){let a=t.map(a=>a.weight);var i=a.length,n=a.reduce((a,t)=>a+t),l=n/i,r=Math.min(...a),h=Math.max(...a),e=h-r;$(".n-akhir").text(i),$(".x-akhir").text(l),$(".s_dev-akhir").text(0),$(".s_rel-akhir").text(0),$(".min-akhir").text(r),$(".max-akhir").text(h),$(".diff-akhir").text(e),$(".sum-akhir").text(n)}}}})):$("#weigher-table-individu-akhir").hide()});var s=$("#weigher-table-individu-awal").DataTable({processing:!0,serverSide:!0,order:[[0,"asc"]],info:!1,ajax:{url:JSON_INDIVIDU_URL,data:function(a){a.bn=i,a.ipc=t}},columns:[{data:"no"},{data:"datetime"},{data:"weight"},{data:"ipc"}]}),o=$("#weigher-table-individu-tengah").DataTable({processing:!0,serverSide:!0,order:[[0,"asc"]],info:!1,ajax:{url:JSON_INDIVIDU_URL,data:function(a){a.bn=i,a.ipc=e}},columns:[{data:"no"},{data:"datetime"},{data:"weight"},{data:"ipc"}]}),d=$("#weigher-table-individu-akhir").DataTable({processing:!0,serverSide:!0,order:[[0,"asc"]],info:!1,ajax:{url:JSON_INDIVIDU_URL,data:function(a){a.bn=i,a.ipc=n}},columns:[{data:"no"},{data:"datetime"},{data:"weight"},{data:"ipc"}]});$("#export-pdf-btn").on("click",function(a){a.preventDefault();var t=$("#weigher-table-individu-awal").is(":visible"),e=$("#weigher-table-individu-tengah").is(":visible"),a=$("#weigher-table-individu-akhir").is(":visible"),e={awal:t?s.rows().data().toArray():[],tengah:e?o.rows().data().toArray():[],akhir:a?d.rows().data().toArray():[]},a={awal:{n:parseFloat($(".n-awal").text()),x:parseFloat($(".x-awal").text()),s_dev:parseFloat($(".s_dev-awal").text()),s_rel:parseFloat($(".s_rel-awal").text()),min:parseFloat($(".min-awal").text()),max:parseFloat($(".max-awal").text()),diff:parseFloat($(".diff-awal").text()),sum:parseFloat($(".sum-awal").text())},tengah:{n:parseFloat($(".n-tengah").text()),x:parseFloat($(".x-tengah").text()),s_dev:parseFloat($(".s_dev-tengah").text()),s_rel:parseFloat($(".s_rel-tengah").text()),min:parseFloat($(".min-tengah").text()),max:parseFloat($(".max-tengah").text()),diff:parseFloat($(".diff-tengah").text()),sum:parseFloat($(".sum-tengah").text())},akhir:{n:parseFloat($(".n-akhir").text()),x:parseFloat($(".x-akhir").text()),s_dev:parseFloat($(".s_dev-akhir").text()),s_rel:parseFloat($(".s_rel-akhir").text()),min:parseFloat($(".min-akhir").text()),max:parseFloat($(".max-akhir").text()),diff:parseFloat($(".diff-akhir").text()),sum:parseFloat($(".sum-akhir").text())}};$.ajax({url:JSON_INDIVIDU_PRINT_URL,method:"POST",data:{data:e,summary:a,bn:i,_token:CSRF_TOKEN}})})});